<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - WMSU Research</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Admin Login -->
    <div id="adminLoginPage" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <i class="fas fa-users-cog"></i>
                <h1>WMSU Research Admin</h1>
                <p>Sign in to access the dashboard</p>
            </div>
            <div class="login-error" id="adminLoginError" style="display: none;">
                Invalid username or password. Please try again.
            </div>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="adminUsername">Username</label>
                    <input type="text" id="adminUsername" class="form-control" placeholder="Enter your username" required value="admin">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" class="form-control" placeholder="Enter your password" required value="admin123">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" style="display: none;">
        <header class="admin-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-users-cog"></i>
                        <h1>WMSU Research - Admin Dashboard</h1>
                    </div>
                    <div class="admin-nav">
                        <span class="admin-welcome">Welcome, <span id="adminName">Administrator</span></span>
                        <a href="index.html" class="btn btn-outline">
                            <i class="fas fa-external-link-alt"></i> View Client Portal
                        </a>
                        <button class="btn btn-secondary" id="exportDataBtn">
                            <i class="fas fa-download"></i> Export Data
                        </button>
                        <button class="btn btn-logout" id="adminLogoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="container">
            <div class="admin-dashboard">
                <!-- Quick Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--secondary);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number" id="totalClients">0</div>
                            <div class="stat-label">Total Clients</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success);">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number" id="activeClients">0</div>
                            <div class="stat-label">Active Clients</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--warning);">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number" id="totalFiles">0</div>
                            <div class="stat-label">Total Files</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--danger);">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-number" id="totalStorage">0</div>
                            <div class="stat-label">GB Storage Used</div>
                        </div>
                    </div>
                </div>

                <!-- Create Account Form -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Create New Client Account</h3>
                        <i class="fas fa-user-plus" style="color: var(--success);"></i>
                    </div>
                    <div class="card-body">
                        <form id="createAccountForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="clientName">Client Name *</label>
                                    <input type="text" id="clientName" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="clientEmail">Email *</label>
                                    <input type="email" id="clientEmail" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="username">Username *</label>
                                    <input type="text" id="username" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="password">Password *</label>
                                    <input type="password" id="password" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="subdomain">Subdomain *</label>
                                    <div class="input-group">
                                        <input type="text" id="subdomain" class="form-control" required>
                                        <span class="input-suffix">.wmsu-research.com</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="plan">Plan</label>
                                    <select id="plan" class="form-control">
                                        <option value="basic">Basic</option>
                                        <option value="standard" selected>Standard</option>
                                        <option value="premium">Premium</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="storageLimit">Storage Limit (MB)</label>
                                <input type="number" id="storageLimit" class="form-control" value="1000" min="100" max="10000">
                            </div>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-plus"></i> Create Account
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Clients Table -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Client Accounts</h3>
                        <div class="search-box">
                            <input type="text" id="searchClients" class="form-control" placeholder="Search clients...">
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Client Name</th>
                                    <th>Username</th>
                                    <th>Subdomain</th>
                                    <th>Plan</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="clientsTable">
                                <!-- Clients will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Client Modal -->
        <div class="modal" id="editClientModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Client Account</h3>
                    <button class="btn-icon close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="editClientForm">
                        <input type="hidden" id="editClientId">
                        <div class="form-group">
                            <label for="editClientName">Client Name</label>
                            <input type="text" id="editClientName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="editClientEmail">Email</label>
                            <input type="email" id="editClientEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="editPassword">New Password (leave blank to keep current)</label>
                            <input type="password" id="editPassword" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="editPlan">Plan</label>
                            <select id="editPlan" class="form-control">
                                <option value="basic">Basic</option>
                                <option value="standard">Standard</option>
                                <option value="premium">Premium</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editStorageLimit">Storage Limit (MB)</label>
                            <input type="number" id="editStorageLimit" class="form-control" min="100" max="10000">
                        </div>
                        <div class="form-group">
                            <label for="editStatus">Status</label>
                            <select id="editStatus" class="form-control">
                                <option value="active">Active</option>
                                <option value="suspended">Suspended</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary close-modal">Cancel</button>
                    <button class="btn btn-danger" id="deleteClientBtn">Delete Account</button>
                    <button class="btn btn-success" id="saveClientBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple admin login system
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded - initializing admin system');
            
            // Check if already logged in
            const adminUser = localStorage.getItem('adminUser');
            if (adminUser) {
                showDashboard();
                return;
            }

            // Setup login form
            const loginForm = document.getElementById('adminLoginForm');
            if (loginForm) {
                console.log('Login form found');
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    console.log('Login form submitted');
                    
                    const username = document.getElementById('adminUsername').value;
                    const password = document.getElementById('adminPassword').value;
                    const errorDiv = document.getElementById('adminLoginError');
                    
                    console.log('Username:', username, 'Password:', password);
                    
                    // Simple validation
                    if (username === 'admin' && password === 'admin123') {
                        console.log('Login successful');
                        localStorage.setItem('adminUser', JSON.stringify({
                            id: 'admin',
                            name: 'System Administrator',
                            username: 'admin',
                            role: 'admin'
                        }));
                        showDashboard();
                    } else {
                        console.log('Login failed');
                        errorDiv.style.display = 'block';
                    }
                });
            } else {
                console.log('Login form NOT found');
            }

            // Setup logout button
            const logoutBtn = document.getElementById('adminLogoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    localStorage.removeItem('adminUser');
                    showLogin();
                });
            }

            function showLogin() {
                console.log('Showing login page');
                document.getElementById('adminLoginPage').style.display = 'flex';
                document.getElementById('adminDashboard').style.display = 'none';
            }

            function showDashboard() {
                console.log('Showing dashboard');
                document.getElementById('adminLoginPage').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                
                // Initialize dashboard
                initializeDashboard();
            }

            function initializeDashboard() {
                console.log('Initializing dashboard');
                
                // Set admin name
                const adminName = document.getElementById('adminName');
                if (adminName) {
                    adminName.textContent = 'System Administrator';
                }
                
                // Load clients
                loadClients();
                
                // Update stats
                updateStats();
                
                // Setup create account form
                const createForm = document.getElementById('createAccountForm');
                if (createForm) {
                    createForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        createClientAccount();
                    });
                }
                
                // Setup search
                const searchInput = document.getElementById('searchClients');
                if (searchInput) {
                    searchInput.addEventListener('input', function(e) {
                        filterClients(e.target.value);
                    });
                }
                
                // Setup export button
                const exportBtn = document.getElementById('exportDataBtn');
                if (exportBtn) {
                    exportBtn.addEventListener('click', exportData);
                }
                
                // Setup modal events
                setupModalEvents();
            }

            function loadClients() {
                console.log('Loading clients');
                const clientsTable = document.getElementById('clientsTable');
                if (!clientsTable) {
                    console.log('Clients table not found');
                    return;
                }
                
                // For now, use sample data
                const clients = [
                    {
                        id: 1,
                        name: 'Sample Client',
                        username: 'sampleuser',
                        subdomain: 'sample',
                        plan: 'standard',
                        status: 'active',
                        accountCreated: '2024-01-01'
                    }
                ];
                
                displayClients(clients);
            }

            function displayClients(clients) {
                const clientsTable = document.getElementById('clientsTable');
                clientsTable.innerHTML = '';
                
                clients.forEach(client => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${client.name}</td>
                        <td>${client.username}</td>
                        <td>${client.subdomain}.wmsu-research.com</td>
                        <td><span class="badge badge-${client.plan}">${client.plan}</span></td>
                        <td><span class="status status-${client.status}">${client.status}</span></td>
                        <td>${client.accountCreated}</td>
                        <td>
                            <button class="btn-icon btn-edit" onclick="editClient(${client.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteClient(${client.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    clientsTable.appendChild(row);
                });
            }

            function updateStats() {
                console.log('Updating stats');
                // Sample stats for now
                document.getElementById('totalClients').textContent = '1';
                document.getElementById('activeClients').textContent = '1';
                document.getElementById('totalFiles').textContent = '0';
                document.getElementById('totalStorage').textContent = '0.00';
            }

            function createClientAccount() {
                const clientName = document.getElementById('clientName').value;
                const clientEmail = document.getElementById('clientEmail').value;
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const subdomain = document.getElementById('subdomain').value;
                const plan = document.getElementById('plan').value;
                const storageLimit = document.getElementById('storageLimit').value;
                
                alert(`Client account created:\nName: ${clientName}\nEmail: ${clientEmail}\nUsername: ${username}\nSubdomain: ${subdomain}\nPlan: ${plan}\nStorage: ${storageLimit}MB`);
                
                // Clear form
                document.getElementById('createAccountForm').reset();
                
                // Reload clients
                loadClients();
                updateStats();
            }

            function filterClients(searchTerm) {
                console.log('Filtering clients:', searchTerm);
                // Implementation would go here
            }

            function exportData() {
                alert('Exporting data...');
                // Implementation would go here
            }

            function setupModalEvents() {
                const modal = document.getElementById('editClientModal');
                const closeButtons = document.querySelectorAll('.close-modal');
                
                closeButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        modal.style.display = 'none';
                    });
                });
                
                window.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            }

            // Global functions for button clicks
            window.editClient = function(clientId) {
                alert('Edit client: ' + clientId);
                document.getElementById('editClientModal').style.display = 'block';
            };

            window.deleteClient = function(clientId) {
                if (confirm('Are you sure you want to delete this client?')) {
                    alert('Delete client: ' + clientId);
                    loadClients();
                    updateStats();
                }
            };

            // Show login by default
            showLogin();
        });
    </script>
</body>
</html>